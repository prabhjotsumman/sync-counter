{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///Users/prabhjot/shared-counter-app/src/lib/offlineStorage.ts"],"sourcesContent":["import { Counter } from './counters';\n\nconst COUNTERS_STORAGE_KEY = 'offline_counters';\nconst PENDING_CHANGES_KEY = 'pending_changes';\n\nexport interface OfflineCounterData {\n  counters: Counter[];\n  lastSync: number;\n  lastServerSync: number;\n}\n\nexport interface PendingChange {\n  id: string;\n  type: 'increment' | 'decrement' | 'create' | 'update' | 'delete';\n  timestamp: number;\n  delta?: number;\n  previousValue?: number;\n  newValue?: number;\n  counterData?: Omit<Counter, 'id'> & { id?: string };\n}\n\n// Get counters from local storage\nexport function getOfflineCounters(): Counter[] {\n  try {\n    const data = localStorage.getItem(COUNTERS_STORAGE_KEY);\n    if (data) {\n      const parsed = JSON.parse(data) as OfflineCounterData;\n      return parsed.counters || [];\n    }\n  } catch (error) {\n    console.error('Failed to get offline counters:', error);\n  }\n  return [];\n}\n\n// Save counters to local storage\nexport function saveOfflineCounters(counters: Counter[], serverSyncTime?: number): void {\n  try {\n    const existingData = localStorage.getItem(COUNTERS_STORAGE_KEY);\n    const data: OfflineCounterData = existingData \n      ? JSON.parse(existingData)\n      : { counters: [], lastSync: 0, lastServerSync: 0 };\n    \n    data.counters = counters;\n    data.lastSync = Date.now();\n    if (serverSyncTime) {\n      data.lastServerSync = serverSyncTime;\n    }\n    \n    localStorage.setItem(COUNTERS_STORAGE_KEY, JSON.stringify(data));\n  } catch (error) {\n    console.error('Failed to save offline counters:', error);\n  }\n}\n\n// Get pending changes from local storage\nexport function getPendingChanges(): PendingChange[] {\n  try {\n    const data = localStorage.getItem(PENDING_CHANGES_KEY);\n    if (data) {\n      return JSON.parse(data) || [];\n    }\n  } catch (error) {\n    console.error('Failed to get pending changes:', error);\n  }\n  return [];\n}\n\n// Save pending changes to local storage\nexport function savePendingChanges(changes: PendingChange[]): void {\n  try {\n    localStorage.setItem(PENDING_CHANGES_KEY, JSON.stringify(changes));\n  } catch (error) {\n    console.error('Failed to save pending changes:', error);\n  }\n}\n\n// Add a pending change\nexport function addPendingChange(change: Omit<PendingChange, 'timestamp'>): void {\n  try {\n    const changes = getPendingChanges();\n    changes.push({\n      ...change,\n      timestamp: Date.now()\n    });\n    savePendingChanges(changes);\n  } catch (error) {\n    console.error('Failed to add pending change:', error);\n  }\n}\n\n// Clear pending changes\nexport function clearPendingChanges(): void {\n  try {\n    localStorage.removeItem(PENDING_CHANGES_KEY);\n  } catch (error) {\n    console.error('Failed to clear pending changes:', error);\n  }\n}\n\n// Update a counter locally with proper timestamp tracking\nexport function updateOfflineCounter(id: string, delta: number): Counter | null {\n  try {\n    const counters = getOfflineCounters();\n    const counterIndex = counters.findIndex(c => c.id === id);\n    \n    if (counterIndex === -1) {\n      return null;\n    }\n    \n    const previousValue = counters[counterIndex].value;\n    const newValue = previousValue + delta;\n    \n    // Update the counter\n    counters[counterIndex].value = newValue;\n    \n    // Save updated counters\n    saveOfflineCounters(counters);\n    \n    // Add pending change with full context\n    addPendingChange({\n      id,\n      type: delta > 0 ? 'increment' : 'decrement',\n      delta,\n      previousValue,\n      newValue\n    });\n    \n    return counters[counterIndex];\n  } catch (error) {\n    console.error('Failed to update offline counter:', error);\n    return null;\n  }\n}\n\n// Add a new counter locally\nexport function addOfflineCounter(counterData: Omit<Counter, 'id'> & { id?: string }): Counter | null {\n  try {\n    const counters = getOfflineCounters();\n    const newCounter: Counter = {\n      id: counterData.id || `counter-${Date.now()}`,\n      name: counterData.name,\n      value: counterData.value,\n      lastUpdated: Date.now()\n    };\n    \n    counters.push(newCounter);\n    saveOfflineCounters(counters);\n    \n    // Add pending change for creation\n    addPendingChange({\n      id: newCounter.id,\n      type: 'create',\n      counterData: {\n        name: newCounter.name,\n        value: newCounter.value\n      }\n    });\n    \n    return newCounter;\n  } catch (error) {\n    console.error('Failed to add offline counter:', error);\n    return null;\n  }\n}\n\n// Update a counter locally (for name/value changes)\nexport function updateOfflineCounterData(id: string, counterData: Omit<Counter, 'id'>): Counter | null {\n  try {\n    const counters = getOfflineCounters();\n    const counterIndex = counters.findIndex(c => c.id === id);\n    \n    if (counterIndex === -1) {\n      return null;\n    }\n    \n    const updatedCounter = {\n      ...counters[counterIndex],\n      ...counterData,\n      lastUpdated: Date.now()\n    };\n    \n    counters[counterIndex] = updatedCounter;\n    saveOfflineCounters(counters);\n    \n    // Add pending change for update\n    addPendingChange({\n      id,\n      type: 'update',\n      counterData: {\n        name: updatedCounter.name,\n        value: updatedCounter.value\n      }\n    });\n    \n    return updatedCounter;\n  } catch (error) {\n    console.error('Failed to update offline counter data:', error);\n    return null;\n  }\n}\n\n// Delete a counter locally\nexport function deleteOfflineCounter(id: string): boolean {\n  try {\n    const counters = getOfflineCounters();\n    const counterIndex = counters.findIndex(c => c.id === id);\n    \n    if (counterIndex === -1) {\n      return false;\n    }\n    \n    const deletedCounter = counters[counterIndex];\n    counters.splice(counterIndex, 1);\n    saveOfflineCounters(counters);\n    \n    // Add pending change for deletion\n    addPendingChange({\n      id,\n      type: 'delete',\n      counterData: {\n        name: deletedCounter.name,\n        value: deletedCounter.value\n      }\n    });\n    \n    return true;\n  } catch (error) {\n    console.error('Failed to delete offline counter:', error);\n    return false;\n  }\n}\n\n// Get last sync timestamp\nexport function getLastSyncTimestamp(): number {\n  try {\n    const data = localStorage.getItem(COUNTERS_STORAGE_KEY);\n    if (data) {\n      const parsed = JSON.parse(data) as OfflineCounterData;\n      return parsed.lastSync || 0;\n    }\n  } catch (error) {\n    console.error('Failed to get last sync timestamp:', error);\n  }\n  return 0;\n}\n\n// Get last server sync timestamp\nexport function getLastServerSyncTimestamp(): number {\n  try {\n    const data = localStorage.getItem(COUNTERS_STORAGE_KEY);\n    if (data) {\n      const parsed = JSON.parse(data) as OfflineCounterData;\n      return parsed.lastServerSync || 0;\n    }\n  } catch (error) {\n    console.error('Failed to get last server sync timestamp:', error);\n  }\n  return 0;\n}\n\n// Check if data is stale (older than 5 minutes)\nexport function isDataStale(): boolean {\n  const lastSync = getLastSyncTimestamp();\n  const fiveMinutes = 5 * 60 * 1000;\n  return Date.now() - lastSync > fiveMinutes;\n}\n\n// Merge server data with local changes based on timestamps\nexport function mergeServerData(serverCounters: Counter[]): Counter[] {\n  try {\n    const localCounters = getOfflineCounters();\n    const pendingChanges = getPendingChanges();\n    const lastServerSync = getLastServerSyncTimestamp();\n    \n    // If no local data, use server data\n    if (localCounters.length === 0) {\n      return serverCounters;\n    }\n    \n    // Create a map of server counters for easy lookup\n    const serverCounterMap = new Map(serverCounters.map(c => [c.id, c]));\n    \n    // Merge each counter\n    const mergedCounters = localCounters.map(localCounter => {\n      const serverCounter = serverCounterMap.get(localCounter.id);\n      \n      if (!serverCounter) {\n        // Server doesn't have this counter, keep local\n        return localCounter;\n      }\n      \n      // Find the latest change for this counter\n      const latestChange = pendingChanges\n        .filter(change => change.id === localCounter.id)\n        .sort((a, b) => b.timestamp - a.timestamp)[0];\n      \n      if (!latestChange) {\n        // No local changes, use server value\n        return serverCounter;\n      }\n      \n      // If our latest change is newer than server sync, use our value\n      if (latestChange.timestamp > lastServerSync) {\n        return localCounter;\n      }\n      \n      // Otherwise, use server value\n      return serverCounter;\n    });\n    \n    return mergedCounters;\n  } catch (error) {\n    console.error('Failed to merge server data:', error);\n    return serverCounters;\n  }\n}\n\n// Sync pending changes to server\nexport async function syncPendingChangesToServer(): Promise<boolean> {\n  try {\n    const pendingChanges = getPendingChanges();\n    if (pendingChanges.length === 0) {\n      return true; // No changes to sync\n    }\n\n    console.log(`Syncing ${pendingChanges.length} pending changes to server...`);\n\n    // Sort all changes by timestamp to apply in chronological order\n    const sortedChanges = pendingChanges.sort((a, b) => a.timestamp - b.timestamp);\n    \n    // Apply each change to the server\n    for (const change of sortedChanges) {\n      try {\n        let response;\n        \n        switch (change.type) {\n          case 'increment':\n          case 'decrement':\n            const endpoint = change.type === 'increment' ? 'increment' : 'decrement';\n            response = await fetch(`/api/counters/${change.id}/${endpoint}`, {\n              method: 'POST',\n            });\n            break;\n            \n          case 'create':\n            response = await fetch('/api/counters', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify(change.counterData)\n            });\n            break;\n            \n          case 'update':\n            response = await fetch(`/api/counters/${change.id}`, {\n              method: 'PUT',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify(change.counterData)\n            });\n            break;\n            \n          case 'delete':\n            response = await fetch(`/api/counters/${change.id}`, {\n              method: 'DELETE'\n            });\n            break;\n            \n          default:\n            console.error(`Unknown change type: ${change.type}`);\n            return false;\n        }\n\n        if (!response.ok) {\n          console.error(`Failed to sync change for counter ${change.id}:`, change);\n          return false;\n        }\n      } catch (error) {\n        console.error(`Error syncing change for counter ${change.id}:`, error);\n        return false;\n      }\n    }\n\n    // Clear pending changes after successful sync\n    clearPendingChanges();\n    console.log('Successfully synced all pending changes to server');\n    return true;\n  } catch (error) {\n    console.error('Failed to sync pending changes:', error);\n    return false;\n  }\n}\n\n// Clear all offline data\nexport function clearOfflineData(): void {\n  try {\n    localStorage.removeItem(COUNTERS_STORAGE_KEY);\n    localStorage.removeItem(PENDING_CHANGES_KEY);\n  } catch (error) {\n    console.error('Failed to clear offline data:', error);\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 346, "column": 0}, "map": {"version":3,"sources":["file:///Users/prabhjot/shared-counter-app/src/components/Counter.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { updateOfflineCounter, saveOfflineCounters, getOfflineCounters } from '@/lib/offlineStorage';\n\ninterface CounterProps {\n  id: string;\n  name: string;\n  value: number;\n  onUpdate: (id: string, newValue: number) => void;\n  isOffline?: boolean;\n  allCounters?: Array<{ id: string; name: string; value: number }>;\n  isManageMode?: boolean;\n  onEdit?: (counter: { id: string; name: string; value: number }) => void;\n  onDelete?: (id: string) => void;\n}\n\nexport default function Counter({ id, name, value, onUpdate, isOffline = false, allCounters = [], isManageMode = false, onEdit, onDelete }: CounterProps) {\n  const [isLoading, setIsLoading] = useState(false);\n  const [lastAction, setLastAction] = useState<'increment' | 'decrement' | null>(null);\n\n  const handleIncrement = async () => {\n    setIsLoading(true);\n    setLastAction('increment');\n    \n    if (isOffline) {\n      // Handle offline increment\n      const updatedCounter = updateOfflineCounter(id, 1);\n      if (updatedCounter) {\n        onUpdate(id, updatedCounter.value);\n      }\n      setIsLoading(false);\n      setTimeout(() => setLastAction(null), 1000);\n      return;\n    }\n\n    try {\n      const response = await fetch(`/api/counters/${id}/increment`, {\n        method: 'POST',\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        const updatedCounter = data.counter;\n        onUpdate(id, updatedCounter.value);\n        \n        // Update local storage with the latest counter values\n        const updatedCounters = allCounters.map(counter => \n          counter.id === id ? { ...counter, value: updatedCounter.value } : counter\n        );\n        saveOfflineCounters(updatedCounters);\n      }\n    } catch (error) {\n      console.error('Error incrementing counter:', error);\n      // Fallback to offline mode if network fails\n      const updatedCounter = updateOfflineCounter(id, 1);\n      if (updatedCounter) {\n        onUpdate(id, updatedCounter.value);\n      }\n    } finally {\n      setIsLoading(false);\n      // Clear the action indicator after a short delay\n      setTimeout(() => setLastAction(null), 1000);\n    }\n  };\n\n  const handleDecrement = async () => {\n    setIsLoading(true);\n    setLastAction('decrement');\n    \n    if (isOffline) {\n      // Handle offline decrement\n      const updatedCounter = updateOfflineCounter(id, -1);\n      if (updatedCounter) {\n        onUpdate(id, updatedCounter.value);\n      }\n      setIsLoading(false);\n      setTimeout(() => setLastAction(null), 1000);\n      return;\n    }\n\n    try {\n      const response = await fetch(`/api/counters/${id}/decrement`, {\n        method: 'POST',\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        const updatedCounter = data.counter;\n        onUpdate(id, updatedCounter.value);\n        \n        // Update local storage with the latest counter values\n        const updatedCounters = allCounters.map(counter => \n          counter.id === id ? { ...counter, value: updatedCounter.value } : counter\n        );\n        saveOfflineCounters(updatedCounters);\n      }\n    } catch (error) {\n      console.error('Error decrementing counter:', error);\n      // Fallback to offline mode if network fails\n      const updatedCounter = updateOfflineCounter(id, -1);\n      if (updatedCounter) {\n        onUpdate(id, updatedCounter.value);\n      }\n    } finally {\n      setIsLoading(false);\n      // Clear the action indicator after a short delay\n      setTimeout(() => setLastAction(null), 1000);\n    }\n  };\n\n  return (\n    <div className={`bg-gray-900 rounded-lg p-8 text-center min-w-[300px] transition-all duration-200 ${\n      lastAction ? 'ring-2 ring-blue-500 ring-opacity-50' : ''\n    } ${isOffline ? 'ring-2 ring-yellow-500 ring-opacity-30' : ''}`}>\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-xl font-semibold text-white\">{name}</h3>\n        <div className=\"flex items-center gap-2\">\n          {isOffline && (\n            <div className=\"flex items-center gap-1 text-yellow-400 text-xs\">\n              <div className=\"w-2 h-2 bg-yellow-400 rounded-full\"></div>\n              Offline\n            </div>\n          )}\n          {isManageMode && onEdit && (\n            <>\n              <button\n                onClick={() => onEdit({ id, name, value })}\n                className=\"p-1 text-gray-400 hover:text-white transition-colors duration-200\"\n                title=\"Edit counter\"\n              >\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\n                </svg>\n              </button>\n              {onDelete && (\n                <button\n                  onClick={() => {\n                    if (window.confirm('Are you sure you want to delete this counter?')) {\n                      onDelete(id);\n                    }\n                  }}\n                  className=\"p-1 text-red-400 hover:text-red-600 transition-colors duration-200\"\n                  title=\"Delete counter\"\n                >\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              )}\n            </>\n          )}\n        </div>\n      </div>\n      \n      <div className={`text-6xl font-bold mb-8 transition-all duration-300 ${\n        lastAction === 'increment' ? 'text-green-400' : \n        lastAction === 'decrement' ? 'text-red-400' : \n        'text-white'\n      }`}>\n        {value}\n      </div>\n      \n      <div className=\"flex gap-4 justify-center\">\n        <button\n          onClick={handleDecrement}\n          disabled={isLoading}\n          className={`font-bold py-3 px-6 rounded-lg text-xl transition-all duration-200 min-w-[80px] ${\n            isLoading && lastAction === 'decrement'\n              ? 'bg-red-800 text-gray-300 cursor-not-allowed'\n              : 'bg-red-600 hover:bg-red-700 text-white'\n          }`}\n        >\n          –\n        </button>\n        \n        <button\n          onClick={handleIncrement}\n          disabled={isLoading}\n          className={`font-bold py-3 px-6 rounded-lg text-xl transition-all duration-200 min-w-[80px] ${\n            isLoading && lastAction === 'increment'\n              ? 'bg-green-800 text-gray-300 cursor-not-allowed'\n              : 'bg-green-600 hover:bg-green-700 text-white'\n          }`}\n        >\n          +\n        </button>\n      </div>\n      \n      {isLoading && (\n        <div className=\"mt-4 text-gray-400 text-sm flex items-center justify-center gap-2\">\n          <div className=\"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin\"></div>\n          Updating...\n        </div>\n      )}\n      \n      {lastAction && !isLoading && (\n        <div className=\"mt-2 text-xs text-gray-500\">\n          {lastAction === 'increment' ? '✓ Incremented' : '✓ Decremented'}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 630, "column": 0}, "map": {"version":3,"sources":["file:///Users/prabhjot/shared-counter-app/src/components/CounterModal.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Counter } from '@/lib/counters';\n\ninterface CounterModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  counter?: Counter | null;\n  mode: 'edit' | 'add';\n  onSave: (counter: Omit<Counter, 'id'> & { id?: string }) => void;\n  onDelete?: (id: string) => void;\n}\n\nexport default function CounterModal({ \n  isOpen, \n  onClose, \n  counter, \n  mode, \n  onSave, \n  onDelete \n}: CounterModalProps) {\n  const [name, setName] = useState('');\n  const [value, setValue] = useState(0);\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    if (isOpen) {\n      if (mode === 'edit' && counter) {\n        setName(counter.name);\n        setValue(counter.value);\n      } else {\n        setName('');\n        setValue(0);\n      }\n    }\n  }, [isOpen, mode, counter]);\n\n  const handleSave = async () => {\n    if (!name.trim()) {\n      alert('Please enter a counter name');\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      await onSave({\n        id: counter?.id,\n        name: name.trim(),\n        value: value\n      });\n      onClose();\n    } catch (error) {\n      console.error('Failed to save counter:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!counter?.id || !onDelete) return;\n\n    if (!confirm('Are you sure you want to delete this counter?')) {\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      await onDelete(counter.id);\n      onClose();\n    } catch (error) {\n      console.error('Failed to delete counter:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n      <div className=\"bg-gray-900 rounded-lg p-8 max-w-md w-full mx-4\">\n        <h2 className=\"text-2xl font-bold text-white mb-6\">\n          {mode === 'edit' ? 'Edit Counter' : 'Add New Counter'}\n        </h2>\n        \n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-white text-sm font-medium mb-2\">\n              Counter Name\n            </label>\n            <input\n              type=\"text\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              className=\"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500\"\n              placeholder=\"Enter counter name\"\n            />\n          </div>\n          \n          <div>\n            <label className=\"block text-white text-sm font-medium mb-2\">\n              Initial Value\n            </label>\n            <input\n              type=\"number\"\n              value={value}\n              onChange={(e) => setValue(parseInt(e.target.value) || 0)}\n              className=\"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500\"\n              placeholder=\"0\"\n            />\n          </div>\n        </div>\n        \n        <div className=\"flex gap-3 mt-8\">\n          <button\n            onClick={handleSave}\n            disabled={isLoading}\n            className=\"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 text-white px-4 py-2 rounded-lg transition-colors duration-200\"\n          >\n            {isLoading ? 'Saving...' : (mode === 'edit' ? 'Save Changes' : 'Add Counter')}\n          </button>\n          \n          {mode === 'edit' && onDelete && (\n            <button\n              onClick={handleDelete}\n              disabled={isLoading}\n              className=\"bg-red-600 hover:bg-red-700 disabled:bg-red-800 text-white px-4 py-2 rounded-lg transition-colors duration-200\"\n            >\n              {isLoading ? 'Deleting...' : 'Delete'}\n            </button>\n          )}\n          \n          <button\n            onClick={onClose}\n            disabled={isLoading}\n            className=\"bg-gray-600 hover:bg-gray-700 disabled:bg-gray-800 text-white px-4 py-2 rounded-lg transition-colors duration-200\"\n          >\n            Cancel\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AAFA;;;AAce,SAAS,aAAa,EACnC,MAAM,EACN,OAAO,EACP,OAAO,EACP,IAAI,EACJ,MAAM,EACN,QAAQ,EACU;IAClB,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACjC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAE3C,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,QAAQ;YACV,IAAI,SAAS,UAAU,SAAS;gBAC9B,QAAQ,QAAQ,IAAI;gBACpB,SAAS,QAAQ,KAAK;YACxB,OAAO;gBACL,QAAQ;gBACR,SAAS;YACX;QACF;IACF,GAAG;QAAC;QAAQ;QAAM;KAAQ;IAE1B,MAAM,aAAa;QACjB,IAAI,CAAC,KAAK,IAAI,IAAI;YAChB,MAAM;YACN;QACF;QAEA,aAAa;QACb,IAAI;YACF,MAAM,OAAO;gBACX,IAAI,SAAS;gBACb,MAAM,KAAK,IAAI;gBACf,OAAO;YACT;YACA;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,2BAA2B;QAC3C,SAAU;YACR,aAAa;QACf;IACF;IAEA,MAAM,eAAe;QACnB,IAAI,CAAC,SAAS,MAAM,CAAC,UAAU;QAE/B,IAAI,CAAC,QAAQ,kDAAkD;YAC7D;QACF;QAEA,aAAa;QACb,IAAI;YACF,MAAM,SAAS,QAAQ,EAAE;YACzB;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,6BAA6B;QAC7C,SAAU;YACR,aAAa;QACf;IACF;IAEA,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BACX,SAAS,SAAS,iBAAiB;;;;;;8BAGtC,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;8CAA4C;;;;;;8CAG7D,8OAAC;oCACC,MAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;oCACvC,WAAU;oCACV,aAAY;;;;;;;;;;;;sCAIhB,8OAAC;;8CACC,8OAAC;oCAAM,WAAU;8CAA4C;;;;;;8CAG7D,8OAAC;oCACC,MAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,SAAS,SAAS,EAAE,MAAM,CAAC,KAAK,KAAK;oCACtD,WAAU;oCACV,aAAY;;;;;;;;;;;;;;;;;;8BAKlB,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,SAAS;4BACT,UAAU;4BACV,WAAU;sCAET,YAAY,cAAe,SAAS,SAAS,iBAAiB;;;;;;wBAGhE,SAAS,UAAU,0BAClB,8OAAC;4BACC,SAAS;4BACT,UAAU;4BACV,WAAU;sCAET,YAAY,gBAAgB;;;;;;sCAIjC,8OAAC;4BACC,SAAS;4BACT,UAAU;4BACV,WAAU;sCACX;;;;;;;;;;;;;;;;;;;;;;;AAOX","debugId":null}},
    {"offset": {"line": 823, "column": 0}, "map": {"version":3,"sources":["file:///Users/prabhjot/shared-counter-app/src/hooks/useOffline.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\nimport { getPendingChanges, syncPendingChangesToServer } from '@/lib/offlineStorage';\n\ninterface UseOfflineReturn {\n  isOnline: boolean;\n  isOffline: boolean;\n  pendingRequests: number;\n  syncOfflineData: () => Promise<void>;\n}\n\nexport function useOffline(): UseOfflineReturn {\n  const [isOnline, setIsOnline] = useState(true);\n  const [pendingRequests, setPendingRequests] = useState(0);\n  const [swRegistration, setSwRegistration] = useState<ServiceWorkerRegistration | null>(null);\n\n  // Register service worker\n  useEffect(() => {\n    if ('serviceWorker' in navigator) {\n      navigator.serviceWorker\n        .register('/sw.js')\n        .then((registration) => {\n          setSwRegistration(registration);\n          console.log('Service Worker registered successfully');\n        })\n        .catch((error) => {\n          console.error('Service Worker registration failed:', error);\n        });\n    }\n  }, []);\n\n  // Listen for online/offline events\n  useEffect(() => {\n    const handleOnline = () => {\n      setIsOnline(true);\n      console.log('Back online - syncing data...');\n      // Trigger sync when coming back online\n      if (pendingRequests > 0) {\n        syncOfflineData();\n      }\n    };\n\n    const handleOffline = () => {\n      setIsOnline(false);\n      console.log('Gone offline');\n    };\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    // Check initial online status\n    setIsOnline(navigator.onLine);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, [pendingRequests]);\n\n  // Update pending requests count\n  const updatePendingCount = useCallback(() => {\n    const changes = getPendingChanges();\n    setPendingRequests(changes.length);\n  }, []);\n\n  // Sync offline data when back online\n  const syncOfflineData = useCallback(async () => {\n    if (!isOnline) return;\n\n    try {\n      const changes = getPendingChanges();\n      if (changes.length === 0) return;\n\n      console.log(`Syncing ${changes.length} offline changes...`);\n      \n      // Sync pending changes to server\n      const success = await syncPendingChangesToServer();\n      if (success) {\n        // Trigger a page refresh to get updated data\n        window.location.reload();\n      }\n    } catch (error) {\n      console.error('Failed to sync offline data:', error);\n    }\n  }, [isOnline]);\n\n  // Initialize pending requests count and update periodically\n  useEffect(() => {\n    updatePendingCount();\n    \n    const interval = setInterval(updatePendingCount, 1000);\n    return () => clearInterval(interval);\n  }, [updatePendingCount]);\n\n  return {\n    isOnline,\n    isOffline: !isOnline,\n    pendingRequests,\n    syncOfflineData\n  };\n}\n"],"names":[],"mappings":";;;AAAA;AACA;;;AASO,SAAS;IACd,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACzC,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACvD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAoC;IAEvF,0BAA0B;IAC1B,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,mBAAmB,WAAW;YAChC,UAAU,aAAa,CACpB,QAAQ,CAAC,UACT,IAAI,CAAC,CAAC;gBACL,kBAAkB;gBAClB,QAAQ,GAAG,CAAC;YACd,GACC,KAAK,CAAC,CAAC;gBACN,QAAQ,KAAK,CAAC,uCAAuC;YACvD;QACJ;IACF,GAAG,EAAE;IAEL,mCAAmC;IACnC,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,eAAe;YACnB,YAAY;YACZ,QAAQ,GAAG,CAAC;YACZ,uCAAuC;YACvC,IAAI,kBAAkB,GAAG;gBACvB;YACF;QACF;QAEA,MAAM,gBAAgB;YACpB,YAAY;YACZ,QAAQ,GAAG,CAAC;QACd;QAEA,OAAO,gBAAgB,CAAC,UAAU;QAClC,OAAO,gBAAgB,CAAC,WAAW;QAEnC,8BAA8B;QAC9B,YAAY,UAAU,MAAM;QAE5B,OAAO;YACL,OAAO,mBAAmB,CAAC,UAAU;YACrC,OAAO,mBAAmB,CAAC,WAAW;QACxC;IACF,GAAG;QAAC;KAAgB;IAEpB,gCAAgC;IAChC,MAAM,qBAAqB,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QACrC,MAAM,UAAU,CAAA,GAAA,4HAAA,CAAA,oBAAiB,AAAD;QAChC,mBAAmB,QAAQ,MAAM;IACnC,GAAG,EAAE;IAEL,qCAAqC;IACrC,MAAM,kBAAkB,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QAClC,IAAI,CAAC,UAAU;QAEf,IAAI;YACF,MAAM,UAAU,CAAA,GAAA,4HAAA,CAAA,oBAAiB,AAAD;YAChC,IAAI,QAAQ,MAAM,KAAK,GAAG;YAE1B,QAAQ,GAAG,CAAC,CAAC,QAAQ,EAAE,QAAQ,MAAM,CAAC,mBAAmB,CAAC;YAE1D,iCAAiC;YACjC,MAAM,UAAU,MAAM,CAAA,GAAA,4HAAA,CAAA,6BAA0B,AAAD;YAC/C,IAAI,SAAS;gBACX,6CAA6C;gBAC7C,OAAO,QAAQ,CAAC,MAAM;YACxB;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,gCAAgC;QAChD;IACF,GAAG;QAAC;KAAS;IAEb,4DAA4D;IAC5D,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR;QAEA,MAAM,WAAW,YAAY,oBAAoB;QACjD,OAAO,IAAM,cAAc;IAC7B,GAAG;QAAC;KAAmB;IAEvB,OAAO;QACL;QACA,WAAW,CAAC;QACZ;QACA;IACF;AACF","debugId":null}},
    {"offset": {"line": 913, "column": 0}, "map": {"version":3,"sources":["file:///Users/prabhjot/shared-counter-app/src/hooks/useRealtimeSync.ts"],"sourcesContent":["import { useEffect, useRef } from 'react';\n\ninterface SyncEvent {\n  type: 'initial' | 'counter_created' | 'counter_updated' | 'counter_deleted' | 'counter_incremented' | 'counter_decremented';\n  counter?: any;\n  counters?: any[];\n  timestamp: number;\n}\n\ninterface UseRealtimeSyncProps {\n  onCounterCreated?: (counter: any) => void;\n  onCounterUpdated?: (counter: any) => void;\n  onCounterDeleted?: (counter: any) => void;\n  onCounterIncremented?: (counter: any) => void;\n  onCounterDecremented?: (counter: any) => void;\n  onInitialData?: (counters: any[]) => void;\n  isOnline?: boolean;\n}\n\nexport function useRealtimeSync({\n  onCounterCreated,\n  onCounterUpdated,\n  onCounterDeleted,\n  onCounterIncremented,\n  onCounterDecremented,\n  onInitialData,\n  isOnline = true\n}: UseRealtimeSyncProps) {\n  const eventSourceRef = useRef<EventSource | null>(null);\n\n  useEffect(() => {\n    // Only create connection if online and not already connected\n    if (!isOnline || eventSourceRef.current) {\n      return;\n    }\n\n    console.log('Creating SSE connection...');\n    const eventSource = new EventSource('/api/sync');\n    eventSourceRef.current = eventSource;\n\n    eventSource.onmessage = (event) => {\n      try {\n        const data: SyncEvent = JSON.parse(event.data);\n        const callbacks = callbacksRef.current;\n        \n        switch (data.type) {\n          case 'initial':\n            if (callbacks.onInitialData && data.counters) {\n              callbacks.onInitialData(data.counters);\n            }\n            break;\n          case 'counter_created':\n            if (callbacks.onCounterCreated && data.counter) {\n              callbacks.onCounterCreated(data.counter);\n            }\n            break;\n          case 'counter_updated':\n            if (callbacks.onCounterUpdated && data.counter) {\n              callbacks.onCounterUpdated(data.counter);\n            }\n            break;\n          case 'counter_deleted':\n            if (callbacks.onCounterDeleted && data.counter) {\n              callbacks.onCounterDeleted(data.counter);\n            }\n            break;\n          case 'counter_incremented':\n            if (callbacks.onCounterIncremented && data.counter) {\n              callbacks.onCounterIncremented(data.counter);\n            }\n            break;\n          case 'counter_decremented':\n            if (callbacks.onCounterDecremented && data.counter) {\n              callbacks.onCounterDecremented(data.counter);\n            }\n            break;\n        }\n      } catch (error) {\n        console.error('Error parsing sync event:', error);\n      }\n    };\n\n    eventSource.onerror = (error) => {\n      console.error('EventSource error:', error);\n      // Close connection on error\n      if (eventSourceRef.current) {\n        eventSourceRef.current.close();\n        eventSourceRef.current = null;\n      }\n    };\n\n    eventSource.onopen = () => {\n      console.log('SSE connection established');\n    };\n\n    // Cleanup on unmount or when going offline\n    return () => {\n      if (eventSourceRef.current) {\n        console.log('Closing SSE connection...');\n        eventSourceRef.current.close();\n        eventSourceRef.current = null;\n      }\n    };\n  }, [isOnline]); // Only depend on isOnline, not the callback functions\n\n  // Store callback functions in ref to avoid recreating connection\n  const callbacksRef = useRef({\n    onCounterCreated,\n    onCounterUpdated,\n    onCounterDeleted,\n    onCounterIncremented,\n    onCounterDecremented,\n    onInitialData\n  });\n\n  // Update callbacks without recreating connection\n  useEffect(() => {\n    callbacksRef.current = {\n      onCounterCreated,\n      onCounterUpdated,\n      onCounterDeleted,\n      onCounterIncremented,\n      onCounterDecremented,\n      onInitialData\n    };\n  }, [onCounterCreated, onCounterUpdated, onCounterDeleted, onCounterIncremented, onCounterDecremented, onInitialData]);\n\n  return {\n    isConnected: !!eventSourceRef.current\n  };\n}\n"],"names":[],"mappings":";;;AAAA;;AAmBO,SAAS,gBAAgB,EAC9B,gBAAgB,EAChB,gBAAgB,EAChB,gBAAgB,EAChB,oBAAoB,EACpB,oBAAoB,EACpB,aAAa,EACb,WAAW,IAAI,EACM;IACrB,MAAM,iBAAiB,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAsB;IAElD,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,6DAA6D;QAC7D,IAAI,CAAC,YAAY,eAAe,OAAO,EAAE;YACvC;QACF;QAEA,QAAQ,GAAG,CAAC;QACZ,MAAM,cAAc,IAAI,YAAY;QACpC,eAAe,OAAO,GAAG;QAEzB,YAAY,SAAS,GAAG,CAAC;YACvB,IAAI;gBACF,MAAM,OAAkB,KAAK,KAAK,CAAC,MAAM,IAAI;gBAC7C,MAAM,YAAY,aAAa,OAAO;gBAEtC,OAAQ,KAAK,IAAI;oBACf,KAAK;wBACH,IAAI,UAAU,aAAa,IAAI,KAAK,QAAQ,EAAE;4BAC5C,UAAU,aAAa,CAAC,KAAK,QAAQ;wBACvC;wBACA;oBACF,KAAK;wBACH,IAAI,UAAU,gBAAgB,IAAI,KAAK,OAAO,EAAE;4BAC9C,UAAU,gBAAgB,CAAC,KAAK,OAAO;wBACzC;wBACA;oBACF,KAAK;wBACH,IAAI,UAAU,gBAAgB,IAAI,KAAK,OAAO,EAAE;4BAC9C,UAAU,gBAAgB,CAAC,KAAK,OAAO;wBACzC;wBACA;oBACF,KAAK;wBACH,IAAI,UAAU,gBAAgB,IAAI,KAAK,OAAO,EAAE;4BAC9C,UAAU,gBAAgB,CAAC,KAAK,OAAO;wBACzC;wBACA;oBACF,KAAK;wBACH,IAAI,UAAU,oBAAoB,IAAI,KAAK,OAAO,EAAE;4BAClD,UAAU,oBAAoB,CAAC,KAAK,OAAO;wBAC7C;wBACA;oBACF,KAAK;wBACH,IAAI,UAAU,oBAAoB,IAAI,KAAK,OAAO,EAAE;4BAClD,UAAU,oBAAoB,CAAC,KAAK,OAAO;wBAC7C;wBACA;gBACJ;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,6BAA6B;YAC7C;QACF;QAEA,YAAY,OAAO,GAAG,CAAC;YACrB,QAAQ,KAAK,CAAC,sBAAsB;YACpC,4BAA4B;YAC5B,IAAI,eAAe,OAAO,EAAE;gBAC1B,eAAe,OAAO,CAAC,KAAK;gBAC5B,eAAe,OAAO,GAAG;YAC3B;QACF;QAEA,YAAY,MAAM,GAAG;YACnB,QAAQ,GAAG,CAAC;QACd;QAEA,2CAA2C;QAC3C,OAAO;YACL,IAAI,eAAe,OAAO,EAAE;gBAC1B,QAAQ,GAAG,CAAC;gBACZ,eAAe,OAAO,CAAC,KAAK;gBAC5B,eAAe,OAAO,GAAG;YAC3B;QACF;IACF,GAAG;QAAC;KAAS,GAAG,sDAAsD;IAEtE,iEAAiE;IACjE,MAAM,eAAe,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAE;QAC1B;QACA;QACA;QACA;QACA;QACA;IACF;IAEA,iDAAiD;IACjD,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,aAAa,OAAO,GAAG;YACrB;YACA;YACA;YACA;YACA;YACA;QACF;IACF,GAAG;QAAC;QAAkB;QAAkB;QAAkB;QAAsB;QAAsB;KAAc;IAEpH,OAAO;QACL,aAAa,CAAC,CAAC,eAAe,OAAO;IACvC;AACF","debugId":null}},
    {"offset": {"line": 1025, "column": 0}, "map": {"version":3,"sources":["file:///Users/prabhjot/shared-counter-app/src/app/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport Counter from '@/components/Counter';\nimport CounterModal from '@/components/CounterModal';\nimport { useOffline } from '@/hooks/useOffline';\nimport { useRealtimeSync } from '@/hooks/useRealtimeSync';\nimport { getOfflineCounters, saveOfflineCounters, clearPendingChanges, mergeServerData, syncPendingChangesToServer, addOfflineCounter, updateOfflineCounterData, deleteOfflineCounter } from '@/lib/offlineStorage';\n\ninterface CounterData {\n  id: string;\n  name: string;\n  value: number;\n}\n\nexport default function Home() {\n  const [counters, setCounters] = useState<CounterData[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [isManageMode, setIsManageMode] = useState(false);\n  const [modalOpen, setModalOpen] = useState(false);\n  const [modalMode, setModalMode] = useState<'edit' | 'add'>('add');\n  const [editingCounter, setEditingCounter] = useState<CounterData | null>(null);\n  const { isOnline, isOffline, pendingRequests, syncOfflineData } = useOffline();\n\n  // Real-time sync handlers\n  const handleCounterCreated = useCallback((counter: CounterData) => {\n    setCounters(prev => {\n      // Replace if already present, otherwise add\n      if (prev.some(c => c.id === counter.id)) {\n        const newCounters = prev.map(c => c.id === counter.id ? counter : c);\n        saveOfflineCounters(newCounters);\n        return newCounters;\n      }\n      const newCounters = [...prev, counter];\n      saveOfflineCounters(newCounters);\n      return newCounters;\n    });\n  }, []);\n\n  const handleCounterUpdated = useCallback((counter: CounterData) => {\n    setCounters(prev => {\n      const newCounters = prev.map(c => c.id === counter.id ? counter : c);\n      saveOfflineCounters(newCounters);\n      return newCounters;\n    });\n  }, []);\n\n  const handleCounterDeleted = useCallback((counter: CounterData) => {\n    setCounters(prev => {\n      const newCounters = prev.filter(c => c.id !== counter.id);\n      saveOfflineCounters(newCounters);\n      return newCounters;\n    });\n  }, []);\n\n  const handleCounterIncremented = useCallback((counter: CounterData) => {\n    setCounters(prev => {\n      const newCounters = prev.map(c => c.id === counter.id ? counter : c);\n      saveOfflineCounters(newCounters);\n      return newCounters;\n    });\n  }, []);\n\n  const handleCounterDecremented = useCallback((counter: CounterData) => {\n    setCounters(prev => {\n      const newCounters = prev.map(c => c.id === counter.id ? counter : c);\n      saveOfflineCounters(newCounters);\n      return newCounters;\n    });\n  }, []);\n\n  const handleInitialData = useCallback((counters: CounterData[]) => {\n    setCounters(counters);\n    saveOfflineCounters(counters);\n    setIsLoading(false);\n  }, []);\n\n  // Initialize real-time sync\n  const { isConnected } = useRealtimeSync({\n    onCounterCreated: handleCounterCreated,\n    onCounterUpdated: handleCounterUpdated,\n    onCounterDeleted: handleCounterDeleted,\n    onCounterIncremented: handleCounterIncremented,\n    onCounterDecremented: handleCounterDecremented,\n    onInitialData: handleInitialData,\n    isOnline\n  });\n\n  const fetchCounters = async () => {\n    try {\n      const response = await fetch('/api/counters');\n      if (response.ok) {\n        const data = await response.json();\n        const serverCounters = data.counters;\n        const serverTimestamp = data.timestamp;\n        \n        // Merge server data with local changes\n        const mergedCounters = mergeServerData(serverCounters);\n        setCounters(mergedCounters);\n        \n        // Save the merged data with server timestamp\n        saveOfflineCounters(mergedCounters, serverTimestamp);\n        \n        // Clear pending changes that have been synced\n        clearPendingChanges();\n      } else {\n        throw new Error('Failed to fetch counters');\n      }\n    } catch (error) {\n      console.error('Network error, using offline data:', error);\n      // Use offline data if available\n      const offlineCounters = getOfflineCounters();\n      if (offlineCounters.length > 0) {\n        setCounters(offlineCounters);\n        setError('Using offline data - no internet connection');\n      } else {\n        setError('Failed to fetch counters and no offline data available');\n      }\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    // Only fetch counters if not using real-time sync\n    if (!isConnected) {\n      fetchCounters();\n    }\n  }, [isConnected]);\n\n  // Sync offline data when coming back online\n  useEffect(() => {\n    if (isOnline && pendingRequests > 0) {\n      // First sync pending changes to server\n      syncPendingChangesToServer().then((success) => {\n        if (success) {\n          // Then fetch fresh data from server\n          fetchCounters();\n        } else {\n          console.error('Failed to sync pending changes');\n        }\n      });\n    }\n  }, [isOnline, pendingRequests]);\n\n  const handleCounterUpdate = (id: string, newValue: number) => {\n    setCounters(prev => \n      prev.map(counter => \n        counter.id === id ? { ...counter, value: newValue } : counter\n      )\n    );\n  };\n\n  const handleEditCounter = (counter: CounterData) => {\n    setEditingCounter(counter);\n    setModalMode('edit');\n    setModalOpen(true);\n  };\n\n  const handleAddCounter = () => {\n    setEditingCounter(null);\n    setModalMode('add');\n    setModalOpen(true);\n  };\n\n  const handleSaveCounter = async (counterData: { id?: string; name: string; value: number }) => {\n    try {\n      if (isOffline) {\n        // Handle offline operations\n        if (modalMode === 'add') {\n          const newCounter = addOfflineCounter(counterData);\n          if (newCounter) {\n            setCounters(prev => {\n              // Only add if not already present (by id)\n              if (prev.some(c => c.id === newCounter.id)) return prev;\n              return [...prev, newCounter];\n            });\n          }\n        } else {\n          const updatedCounter = updateOfflineCounterData(counterData.id!, counterData);\n          if (updatedCounter) {\n            setCounters(prev => \n              prev.map(counter => \n                counter.id === counterData.id ? updatedCounter : counter\n              )\n            );\n          }\n        }\n        return;\n      }\n\n      // Online operations\n      if (modalMode === 'add') {\n        // Create new counter\n        const response = await fetch('/api/counters', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(counterData)\n        });\n\n        if (response.ok) {\n          const data = await response.json();\n          setCounters(prev => {\n            // Only add if not already present (by id)\n            if (prev.some(c => c.id === data.counter.id)) return prev;\n            return [...prev, data.counter];\n          });\n          saveOfflineCounters([...counters, data.counter]);\n        }\n      } else {\n        // Update existing counter\n        const response = await fetch(`/api/counters/${counterData.id}`, {\n          method: 'PUT',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(counterData)\n        });\n\n        if (response.ok) {\n          const data = await response.json();\n          setCounters(prev => \n            prev.map(counter => \n              counter.id === counterData.id ? data.counter : counter\n            )\n          );\n          saveOfflineCounters(counters.map(counter => \n            counter.id === counterData.id ? data.counter : counter\n          ));\n        }\n      }\n    } catch (error) {\n      console.error('Failed to save counter:', error);\n      // Fallback to offline mode if network fails\n      if (modalMode === 'add') {\n        const newCounter = addOfflineCounter(counterData);\n        if (newCounter) {\n          setCounters(prev => {\n            if (prev.some(c => c.id === newCounter.id)) return prev;\n            return [...prev, newCounter];\n          });\n        }\n      } else {\n        const updatedCounter = updateOfflineCounterData(counterData.id!, counterData);\n        if (updatedCounter) {\n          setCounters(prev => \n            prev.map(counter => \n              counter.id === counterData.id ? updatedCounter : counter\n            )\n          );\n        }\n      }\n    }\n  };\n\n  const handleDeleteCounter = async (id: string) => {\n    try {\n      if (isOffline) {\n        // Handle offline deletion\n        const success = deleteOfflineCounter(id);\n        if (success) {\n          setCounters(prev => prev.filter(counter => counter.id !== id));\n        }\n        return;\n      }\n\n      // Online deletion\n      const response = await fetch(`/api/counters/${id}`, {\n        method: 'DELETE'\n      });\n\n      if (response.ok) {\n        setCounters(prev => prev.filter(counter => counter.id !== id));\n        saveOfflineCounters(counters.filter(counter => counter.id !== id));\n      }\n    } catch (error) {\n      console.error('Failed to delete counter:', error);\n      // Fallback to offline mode if network fails\n      const success = deleteOfflineCounter(id);\n      if (success) {\n        setCounters(prev => prev.filter(counter => counter.id !== id));\n      }\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-black flex items-center justify-center\">\n        <div className=\"text-white text-xl\">Loading counters...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-black flex items-center justify-center\">\n        <div className=\"text-red-400 text-xl\">{error}</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-black text-white\">\n      <div className=\"container mx-auto px-4 py-12\">\n        <header className=\"text-center mb-12\">\n          <h1 className=\"text-4xl font-bold mb-4\">Shared Counters</h1>\n          <p className=\"text-gray-400 text-lg\">\n            Real-time counters shared across all users\n          </p>\n          \n          {/* Connection Status */}\n          <div className=\"mt-4 flex items-center justify-center gap-4\">\n            <div className={`flex items-center gap-2 px-3 py-1 rounded-full text-sm ${\n              isOnline \n                ? 'bg-green-900 text-green-300' \n                : 'bg-yellow-900 text-yellow-300'\n            }`}>\n              <div className={`w-2 h-2 rounded-full ${\n                isOnline ? 'bg-green-400' : 'bg-yellow-400'\n              }`}></div>\n              {isOnline ? 'Online' : 'Offline'}\n            </div>\n            \n            {isOnline && (\n              <div className={`flex items-center gap-2 px-3 py-1 rounded-full text-sm ${\n                isConnected \n                  ? 'bg-purple-900 text-purple-300' \n                  : 'bg-gray-700 text-gray-300'\n              }`}>\n                <div className={`w-2 h-2 rounded-full ${\n                  isConnected ? 'bg-purple-400' : 'bg-gray-400'\n                } ${isConnected ? 'animate-pulse' : ''}`}></div>\n                {isConnected ? 'Real-time Sync' : 'Connecting...'}\n              </div>\n            )}\n            \n            {pendingRequests > 0 && (\n              <div className=\"flex items-center gap-2 px-3 py-1 rounded-full text-sm bg-blue-900 text-blue-300\">\n                <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-pulse\"></div>\n                {pendingRequests} pending\n              </div>\n            )}\n          </div>\n        </header>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto\">\n          {counters.map((counter) => (\n            <Counter\n              key={counter.id}\n              id={counter.id}\n              name={counter.name}\n              value={counter.value}\n              onUpdate={handleCounterUpdate}\n              isOffline={isOffline}\n              allCounters={counters}\n              isManageMode={isManageMode}\n              onEdit={handleEditCounter}\n              onDelete={isManageMode ? handleDeleteCounter : undefined}\n            />\n          ))}\n        </div>\n\n        <div className=\"text-center mt-12 space-y-4\">\n          <div className=\"flex gap-4 justify-center\">\n            <button\n              onClick={() => setIsManageMode(!isManageMode)}\n              className={`px-6 py-3 rounded-lg transition-colors duration-200 ${\n                isManageMode \n                  ? 'bg-red-600 hover:bg-red-700 text-white' \n                  : 'bg-blue-600 hover:bg-blue-700 text-white'\n              }`}\n            >\n              {isManageMode ? 'Exit Manage Mode' : 'Manage Counters'}\n            </button>\n            \n            {isManageMode && (\n              <button\n                onClick={handleAddCounter}\n                className=\"bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors duration-200\"\n              >\n                Add New Counter\n              </button>\n            )}\n            \n            {pendingRequests > 0 && isOnline && (\n              <button\n                onClick={() => syncPendingChangesToServer().then(() => fetchCounters())}\n                className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors duration-200\"\n              >\n                Sync Offline Changes\n              </button>\n            )}\n          </div>\n          \n          {isOffline && (\n            <div className=\"text-yellow-400 text-sm\">\n              You're offline. Changes will be synced when you're back online.\n            </div>\n          )}\n          \n          {pendingRequests > 0 && isOnline && (\n            <div className=\"text-blue-400 text-sm\">\n              Syncing {pendingRequests} offline changes...\n            </div>\n          )}\n        </div>\n        \n        {/* Counter Modal */}\n        <CounterModal\n          isOpen={modalOpen}\n          onClose={() => setModalOpen(false)}\n          counter={editingCounter}\n          mode={modalMode}\n          onSave={handleSaveCounter}\n          onDelete={modalMode === 'edit' ? handleDeleteCounter : undefined}\n        />\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1539, "column": 0}, "map": {"version":3,"sources":["file:///Users/prabhjot/shared-counter-app/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,kBAAkB","ignoreList":[0],"debugId":null}}]
}